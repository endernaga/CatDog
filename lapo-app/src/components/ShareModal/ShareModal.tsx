import React from "react";
import "./ShareModal.scss";
import { Pet } from "../../types/Pet";
import { BASE_URL } from "../../utils/fetchProducts";

type Props = {
  closeModal: () => void;
  pet: Pet;
};

export const ShareModal: React.FC<Props> = ({ closeModal, pet }) => {
  const { name, sex, size, age, images } = pet;
  const params = size ? [name, sex, age, size] : [name, sex, age];

  const pageUrl = encodeURIComponent(window.location.href);
  const pageTitle = encodeURIComponent(document.title);
  //const ngrokUrl = 'https://aafc-79-110-133-41.ngrok-free.app'; // замініть на ваш HTTPS URL від ngrok
  //const pagePath = window.location.pathname + window.location.hash;
  //const pageUrl = encodeURIComponent(`${ngrokUrl}${pagePath}`);

  console.log(pageUrl);

  const handleCopyLink = async (): Promise<void> => {
    try {
      await navigator.clipboard.writeText(window.location.href);
      alert("Link copied to clipboard!");
    } catch (err) {
      console.error("Failed to copy: ", err);
    }
  };

  const openWindow = (url: string) => {
    window.open(url, "_blank", "width=600, height=400");
  };

  const handleViberShare = () => {
    const viberUrl = `https://chats.viber.com/share/url?url=${pageUrl}&text=${pageTitle}`;
    openWindow(viberUrl);
  };

  const handleTelegramShare = () => {
    const telegramUrl = `https://t.me/share/url?url=${pageUrl}`;
    console.log(telegramUrl);
    openWindow(telegramUrl);
  };

  const handleFacebookShare = () => {
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}&quote=${pageTitle}`;
    console.log(facebookUrl);
    openWindow(facebookUrl);
  };

  const handleWhatsappShare = () => {
    const whatsappUrl = `https://wa.me/?text=${pageTitle}%20${pageUrl}`;
    openWindow(whatsappUrl);
  };

  const handleSmsShare = () => {
    const smsUrl: string = `sms:?body=${pageTitle}%20${window.location.href}`;
    openWindow(smsUrl);
  };

  return (
    <>
      <div className="overlay" />
      <div className="share">
        <div className="share__header">
          <p className="share__header__text">Поділитися тваринкою</p>
          <div
            className="icon icon-close icon-close-form"
            onClick={closeModal}
          ></div>
        </div>

        <div className="share__info">
          <img
            className="share__info__photo"
            src={`${BASE_URL}/${images[0]}`}
            alt="pet-photo"
          />
          <div className="share__info__params">
            {params.map((param) => (
              <>
                <h5 className="share__info__text">{param}</h5>
                <div className="share__info__dot" />
              </>
            ))}
          </div>
        </div>

        <div className="share__links">
          <button className="share__item" onClick={handleCopyLink}>
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M7 6V3C7 2.73478 7.10536 2.48043 7.29289 2.29289C7.48043 2.10536 7.73478 2 8 2H20C20.2652 2 20.5196 2.10536 20.7071 2.29289C20.8946 2.48043 21 2.73478 21 3V17C21 17.2652 20.8946 17.5196 20.7071 17.7071C20.5196 17.8946 20.2652 18 20 18H17V21C17 21.552 16.55 22 15.993 22H4.007C3.87509 22.0009 3.7443 21.9757 3.62217 21.9259C3.50003 21.8761 3.38896 21.8025 3.29536 21.7096C3.20176 21.6166 3.12748 21.5061 3.07678 21.3843C3.02609 21.2625 3 21.1319 3 21L3.003 7C3.003 6.448 3.453 6 4.009 6H7ZM5.002 8L5 20H15V8H5.002ZM9 6H17V16H19V4H9V6Z"
                fill="currentColor"
              />
            </svg>
            <p className="share__item__text">Копіювати посилання</p>
          </button>
          <button className="share__item" onClick={handleFacebookShare}>
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M14 13.5H16.5L17.5 9.5H14V7.5C14 6.47 14 5.5 16 5.5H17.5V2.14C17.174 2.097 15.943 2 14.643 2C11.928 2 10 3.657 10 6.7V9.5H7V13.5H10V22H14V13.5Z"
                fill="currentColor"
              />
            </svg>
            <p className="share__item__text">Facebook</p>
          </button>
          <button className="share__item" onClick={handleViberShare}>
            <svg
              width="25"
              height="24"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_2026_2956)">
                <path
                  d="M21.5684 2.33703C20.9475 1.79203 18.4327 0.0400277 12.8324 0.0170277C12.8324 0.0170277 6.22402 -0.361972 3.00489 2.46903C1.21428 4.18503 0.587151 6.69803 0.515151 9.81503C0.443151 12.932 0.362803 18.774 6.23863 20.362H6.24385L6.23863 22.781C6.23863 22.781 6.20002 23.761 6.87202 23.958C7.68385 24.202 8.16385 23.456 8.94124 22.654C9.36698 22.213 9.95341 21.567 10.399 21.074C12.9524 21.3007 15.5274 21.1124 18.0153 20.517L17.8588 20.549C18.6706 20.296 23.264 19.733 24.007 13.892C24.7833 7.86203 23.6376 4.05803 21.5684 2.33703ZM22.2487 13.452C21.6153 18.327 17.8943 18.637 17.2098 18.847C15.7155 19.211 14 19.419 12.2334 19.419C11.7263 19.419 11.2233 19.402 10.7256 19.368L10.7924 19.372C10.7924 19.372 8.24837 22.311 7.45637 23.075C7.19759 23.323 6.91272 23.303 6.91793 22.808C6.91793 22.485 6.93776 18.79 6.93776 18.79C1.9635 17.468 2.2515 12.492 2.30993 9.89303C2.36837 7.29403 2.87759 5.15803 4.39376 3.72403C7.11932 1.35703 12.7301 1.70803 12.7301 1.70803C17.4706 1.72703 19.7402 3.09603 20.2682 3.55503C22.015 4.99003 22.9051 8.42303 22.2487 13.452ZM15.4546 9.66403V9.67803C15.4524 9.7559 15.4191 9.82999 15.3616 9.88501C15.304 9.94003 15.2266 9.97178 15.1454 9.97371C15.0641 9.97563 14.9852 9.94759 14.9249 9.89536C14.8645 9.84313 14.8274 9.7707 14.8212 9.69303C14.8425 9.48424 14.8162 9.27253 14.7442 9.07442C14.6722 8.87631 14.5562 8.69554 14.4042 8.54456C14.2523 8.39359 14.0679 8.27602 13.8639 8.19996C13.6599 8.12391 13.4411 8.09117 13.2226 8.10403H13.2268C13.1457 8.09801 13.0701 8.06237 13.0157 8.00447C12.9612 7.94657 12.9321 7.87084 12.9342 7.79293C12.9363 7.71501 12.9696 7.64085 13.0272 7.58579C13.0848 7.53072 13.1622 7.49895 13.2435 7.49703H13.2612H13.2602L13.3322 7.49603C13.6235 7.49593 13.9118 7.55323 14.179 7.66436C14.4462 7.7755 14.6868 7.93809 14.8857 8.14205C15.0847 8.34601 15.2377 8.58698 15.3354 8.85C15.4331 9.11303 15.4733 9.39248 15.4536 9.67103L15.4546 9.66403ZM16.447 10.195C16.496 8.20703 15.2 6.65103 12.7395 6.47703C12.6968 6.47575 12.6548 6.46622 12.6161 6.44901C12.5773 6.4318 12.5426 6.40727 12.514 6.37689C12.4853 6.3465 12.4634 6.31089 12.4495 6.27219C12.4356 6.23349 12.43 6.19249 12.433 6.15166C12.436 6.11083 12.4476 6.071 12.4671 6.03457C12.4866 5.99814 12.5135 5.96585 12.5463 5.93964C12.5791 5.91344 12.6171 5.89385 12.658 5.88206C12.6989 5.87027 12.7419 5.86652 12.7844 5.87103H12.7833H12.8011C13.385 5.87101 13.9628 5.98538 14.4989 6.20711C15.035 6.42885 15.5182 6.75327 15.9188 7.16046C16.3193 7.56764 16.6288 8.049 16.8282 8.57496C17.0276 9.10093 17.1127 9.6604 17.0783 10.219L17.0793 10.208C17.0737 10.2855 17.0374 10.358 16.9778 10.4107C16.9181 10.4633 16.8397 10.4921 16.7587 10.491C16.6776 10.49 16.6 10.4593 16.5419 10.4052C16.4837 10.3511 16.4494 10.2776 16.4459 10.2V10.192L16.447 10.195ZM18.7426 10.824V10.826C18.7384 10.9035 18.7034 10.9766 18.6448 11.0301C18.5862 11.0837 18.5084 11.1138 18.4274 11.1142C18.3464 11.1145 18.2683 11.0852 18.2092 11.0322C18.15 10.9792 18.1143 10.9065 18.1092 10.829C18.0842 7.00703 15.4244 4.92603 12.2011 4.90403C12.1172 4.90403 12.0368 4.8721 11.9775 4.81528C11.9182 4.75846 11.8849 4.68139 11.8849 4.60103C11.8849 4.52067 11.9182 4.4436 11.9775 4.38677C12.0368 4.32995 12.1172 4.29803 12.2011 4.29803C15.8105 4.32203 18.7113 6.70903 18.7405 10.823L18.7426 10.824ZM18.1948 15.422V15.431C17.6668 16.322 16.6786 17.306 15.6612 16.992L15.6518 16.978C13.8379 16.3383 12.1377 15.4347 10.6108 14.299L10.6536 14.329C9.89381 13.7509 9.20457 13.0924 8.59898 12.366L8.57915 12.341C8.03081 11.6795 7.54144 10.9751 7.11619 10.235L7.07446 10.156C6.57134 9.36114 6.15422 8.51911 5.82959 7.64303L5.79828 7.54503C5.47063 6.57003 6.49219 5.62303 7.42715 5.11703H7.43654C7.62048 5.00419 7.84136 4.96027 8.05695 4.99366C8.27255 5.02705 8.46775 5.13541 8.60524 5.29803L8.60628 5.30003C8.60628 5.30003 9.21254 5.99303 9.47237 6.33603C9.71654 6.65503 10.0452 7.16603 10.2153 7.45103C10.3434 7.64577 10.3955 7.87762 10.3625 8.10562C10.3294 8.33362 10.2134 8.54309 10.0348 8.69703L10.0338 8.69803L9.44732 9.14803C9.35589 9.2326 9.28523 9.33561 9.24047 9.44959C9.19571 9.56357 9.17798 9.68567 9.18854 9.80703V9.80403C9.47892 10.7314 10.003 11.5759 10.7145 12.2632C11.4261 12.9505 12.3032 13.4594 13.2685 13.745L13.3124 13.756C13.4384 13.7655 13.5651 13.7484 13.6834 13.7057C13.8017 13.663 13.9087 13.5958 13.9969 13.509L14.4665 12.947C14.6278 12.7751 14.8474 12.6636 15.0865 12.6323C15.3255 12.601 15.5683 12.6519 15.7718 12.776L15.7677 12.774C16.616 13.237 17.3496 13.746 18.0185 14.323L18.007 14.313C18.1767 14.4427 18.2896 14.6285 18.3236 14.8339C18.3575 15.0393 18.3101 15.2494 18.1906 15.423L18.1927 15.42L18.1948 15.422Z"
                  fill="currentColor"
                />
              </g>
              <defs>
                <clipPath id="clip0_2026_2956">
                  <rect
                    width="24"
                    height="24"
                    fill="white"
                    transform="translate(0.5)"
                  />
                </clipPath>
              </defs>
            </svg>
            <p className="share__item__text">Viber</p>
          </button>
          <button className="share__item" onClick={handleTelegramShare}>
            <svg
              width="25"
              height="24"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M20.0522 2.99703C19.8115 3.01455 19.5751 3.07103 19.3525 3.16428H19.3495C19.1357 3.24903 18.1195 3.67653 16.5745 4.32453L11.038 6.65628C7.06522 8.32878 3.15997 9.97578 3.15997 9.97578L3.20647 9.95778C3.20647 9.95778 2.93722 10.0463 2.65597 10.239C2.48222 10.3496 2.3327 10.4943 2.21647 10.6643C2.07847 10.8668 1.96747 11.1765 2.00872 11.4968C2.07622 12.0383 2.42722 12.363 2.67922 12.5423C2.93422 12.7238 3.17722 12.8085 3.17722 12.8085H3.18322L6.84547 14.0423C7.00972 14.5695 7.96147 17.6985 8.19022 18.4193C8.32522 18.8498 8.45647 19.119 8.62072 19.3245C8.70022 19.4295 8.79322 19.5173 8.90497 19.5878C8.96307 19.6216 9.02501 19.6483 9.08947 19.6673L9.05197 19.6583C9.06322 19.6613 9.07222 19.6703 9.08047 19.6733C9.11047 19.6815 9.13072 19.6845 9.16897 19.6905C9.74872 19.866 10.2145 19.506 10.2145 19.506L10.2407 19.485L12.403 17.5163L16.027 20.2965L16.1095 20.3318C16.8647 20.6633 17.6297 20.4788 18.034 20.1533C18.4412 19.8255 18.5995 19.4063 18.5995 19.4063L18.6257 19.3388L21.4262 4.99203C21.5057 4.63803 21.526 4.30653 21.4382 3.98478C21.3477 3.65915 21.1388 3.37909 20.8525 3.19953C20.612 3.05337 20.3332 2.98282 20.0522 2.99703ZM19.9765 4.53453C19.9735 4.58178 19.9825 4.57653 19.9615 4.66728V4.67553L17.1872 18.873C17.1752 18.8933 17.155 18.9375 17.0995 18.9818C17.041 19.0283 16.9945 19.0575 16.7507 18.9608L12.3182 15.5625L9.64072 18.003L10.2032 14.4105L17.4452 7.66053C17.7437 7.38303 17.644 7.32453 17.644 7.32453C17.665 6.98403 17.1932 7.22478 17.1932 7.22478L8.06122 12.882L8.05822 12.867L3.68122 11.3933V11.3903L3.66997 11.388C3.67765 11.3855 3.68516 11.3825 3.69247 11.379L3.71647 11.367L3.73972 11.3588C3.73972 11.3588 7.64797 9.71178 11.6207 8.03928C13.6097 7.20153 15.6137 6.35778 17.155 5.70678C18.069 5.32203 18.984 4.93953 19.9 4.55928C19.9615 4.53528 19.9322 4.53453 19.9765 4.53453Z"
                fill="currentColor"
              />
            </svg>
            <p className="share__item__text">Telegram</p>
          </button>
          <button className="share__item" onClick={handleSmsShare}>
            <svg
              width="25"
              height="24"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M19.6456 8.99295L9.84661 14.601L9.77661 14.646C9.68366 14.693 9.58077 14.717 9.47661 14.716C9.35784 14.716 9.24126 14.6839 9.13918 14.6232C9.0371 14.5625 8.9533 14.4753 8.89661 14.371L8.85061 14.279L7.01961 10.329C6.99661 10.283 6.99661 10.237 6.99661 10.191C6.99661 10.007 7.13561 9.86995 7.32061 9.86995C7.39061 9.86995 7.46028 9.89295 7.52961 9.93895L9.68461 11.454C9.84661 11.546 10.0316 11.615 10.2406 11.615C10.36 11.6153 10.4783 11.5918 10.5886 11.546L18.8626 7.89695C17.4346 6.27295 15.1346 5.19995 12.5006 5.19995C8.07961 5.19995 4.60061 8.22195 4.60061 11.8C4.60061 13.165 5.10061 14.473 6.03161 15.58C6.08028 15.6386 6.15194 15.7173 6.24661 15.816C6.6395 16.2254 6.94078 16.7137 7.13044 17.2486C7.32009 17.7834 7.39378 18.3525 7.34661 18.918L7.32261 19.215L8.03761 18.779C8.84752 18.2851 9.80659 18.0951 10.7436 18.243C10.9549 18.2763 11.1283 18.3016 11.2636 18.319C11.6703 18.373 12.0826 18.4 12.5006 18.4C16.9206 18.4 20.4006 15.378 20.4006 11.8C20.4006 10.804 20.1306 9.84995 19.6456 8.99295ZM6.69261 21.943C6.53518 22.0415 6.35341 22.0942 6.16768 22.0953C5.98195 22.0963 5.7996 22.0456 5.64107 21.9489C5.48254 21.8521 5.35408 21.7131 5.2701 21.5475C5.18613 21.3818 5.14994 21.196 5.16561 21.011L5.35461 18.752C5.37819 18.4692 5.34135 18.1847 5.24652 17.9173C5.1517 17.6498 5.00106 17.4057 4.80461 17.201C4.70006 17.0932 4.59901 16.9822 4.50161 16.868C3.30561 15.447 2.59961 13.695 2.59961 11.8C2.59961 7.04995 7.03161 3.19995 12.4996 3.19995C17.9666 3.19995 22.3996 7.04995 22.3996 11.8C22.3996 16.55 17.9666 20.4 12.4996 20.4C11.9896 20.3993 11.4896 20.3666 10.9996 20.302C10.8469 20.2819 10.6576 20.254 10.4316 20.218C9.9631 20.144 9.48356 20.239 9.07861 20.486L6.69261 21.943Z"
                fill="currentColor"
              />
            </svg>
            <p className="share__item__text">SMS повідомлення</p>
          </button>
          <button className="share__item" onClick={handleWhatsappShare}>
            <svg
              width="25"
              height="24"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M7.75399 18.494L8.47799 18.917C9.69888 19.6292 11.0876 20.003 12.501 20C14.0832 20 15.63 19.5308 16.9456 18.6518C18.2611 17.7727 19.2865 16.5233 19.892 15.0615C20.4975 13.5997 20.656 11.9911 20.3473 10.4393C20.0386 8.88743 19.2767 7.46197 18.1578 6.34315C17.039 5.22433 15.6136 4.4624 14.0617 4.15372C12.5099 3.84504 10.9013 4.00346 9.43952 4.60896C7.97772 5.21447 6.72829 6.23984 5.84924 7.55544C4.97018 8.87103 4.50099 10.4177 4.50099 12C4.49807 13.4139 4.87226 14.8029 5.58499 16.024L6.00699 16.748L5.35399 19.149L7.75399 18.494ZM2.50499 22L3.85699 17.032C2.96595 15.5049 2.49789 13.768 2.50099 12C2.50099 6.477 6.97799 2 12.501 2C18.024 2 22.501 6.477 22.501 12C22.501 17.523 18.024 22 12.501 22C10.7337 22.003 8.99757 21.5353 7.47099 20.645L2.50499 22ZM8.89199 7.308C9.02666 7.29867 9.16099 7.29733 9.29499 7.304C9.34899 7.308 9.40299 7.31333 9.45699 7.32C9.61599 7.338 9.79099 7.435 9.84999 7.569C10.148 8.24567 10.4373 8.92567 10.718 9.609C10.78 9.761 10.743 9.956 10.625 10.146C10.565 10.243 10.471 10.379 10.362 10.518C10.249 10.663 10.006 10.929 10.006 10.929C10.006 10.929 9.90699 11.047 9.94499 11.194C9.95899 11.25 10.005 11.331 10.047 11.399L10.106 11.494C10.362 11.921 10.706 12.354 11.126 12.762C11.246 12.878 11.363 12.997 11.489 13.108C11.957 13.521 12.487 13.858 13.059 14.108L13.064 14.11C13.149 14.147 13.192 14.167 13.316 14.22C13.378 14.246 13.4417 14.268 13.507 14.286C13.531 14.2927 13.5553 14.2963 13.58 14.297C13.637 14.2992 13.6937 14.2874 13.7451 14.2626C13.7965 14.2379 13.8411 14.2009 13.875 14.155C14.598 13.279 14.665 13.222 14.67 13.222V13.224C14.7202 13.177 14.78 13.1413 14.8452 13.1194C14.9104 13.0975 14.9796 13.0898 15.048 13.097C15.1093 13.0997 15.1683 13.113 15.225 13.137C15.756 13.38 16.625 13.759 16.625 13.759L17.207 14.02C17.305 14.067 17.394 14.178 17.397 14.285C17.401 14.352 17.407 14.46 17.384 14.658C17.352 14.917 17.274 15.228 17.196 15.391C17.1419 15.5019 17.0711 15.6037 16.986 15.693C16.885 15.7989 16.7745 15.8953 16.656 15.981C16.5733 16.0423 16.5317 16.0723 16.531 16.071C16.4066 16.1499 16.2788 16.2233 16.148 16.291C15.8904 16.4275 15.6061 16.506 15.315 16.521C15.13 16.531 14.945 16.545 14.759 16.535C14.751 16.535 14.191 16.448 14.191 16.448C12.7693 16.074 11.4544 15.3734 10.351 14.402C10.125 14.203 9.91499 13.989 9.70099 13.776C8.81299 12.891 8.13999 11.936 7.73099 11.034C7.52349 10.5912 7.41108 10.1099 7.40099 9.621C7.39723 9.01375 7.59605 8.42257 7.96599 7.941C8.03899 7.847 8.10799 7.749 8.22699 7.636C8.35299 7.516 8.43399 7.452 8.52099 7.408C8.63703 7.351 8.76302 7.31704 8.89199 7.308Z"
                fill="currentColor"
              />
            </svg>
            <p className="share__item__text">WhatsApp</p>
          </button>
        </div>
      </div>
    </>
  );
};
